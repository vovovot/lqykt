<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的购物车 - 蓝桥云课堂</title>
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="bootstrap-3.3.7/css/bootstrap.css">
    <link rel="stylesheet" href="layui/css/layui.css" type="text/css">
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/regedit.css" type="text/css">

    <script src="js/jquery-3.3.1.js"></script>
    <!--<script src="js/jquery.min.js"></script>-->
    <script src="js/cart.js"></script>
    <script src="bootstrap-3.3.7/js/bootstrap.js" type="application/javascript"></script>
    <script src="layui/layui.js" type="application/javascript"></script>
    <script src="js/general.js"></script>
    <!--<script src="js/layer.js" type="application/javascript"></script>-->
    <script src="js/jquery.validate.js" type="application/javascript"></script>
    <script src="js/index1.js" type="application/javascript"></script>
    <script>
        $(function () {
            //获取cookie字符串
            var strCookie=document.cookie;
            //将多cookie切割为多个名/值对
            var arrCookie=strCookie.split("; ");
            var user_id;
            //遍历cookie数组，处理每个cookie对
            for(var i=0;i<arrCookie.length;i++){
                var arr=arrCookie[i].split("=");
                //找到名称为userId的cookie，并返回它的值
                if("user_id"==arr[0]){
                    user_id=arr[1];
                    break;
                }
            }

            $.ajax({
                url: "/ShowCartInfo",
                type: "post",
                dataType: "json",
                asycn:false,
                data: {
                    "user_id": user_id,
                },
                success: function (ret) {
                    if (ret.length > 0) {
                        var $modelNode = $(".info_tmpl").detach();
                        for (var i = 0; i < ret.length; i++) {
                            var $cloneNode = $modelNode.clone(true);
                            $cloneNode.find("span.company").text(ret[i].company);
                            $cloneNode.find("img.cover").attr("src",ret[i].cover);
                            $cloneNode.find("span.course_name").text(ret[i].course_name);
                            $cloneNode.find("span.price").text(ret[i].price);
                            $cloneNode.find("span.price1").text(ret[i].price);
                            $cloneNode.find("input.checkone").attr("id",ret[i].course_id);
                            $cloneNode.find("div.class_delete").attr("id",ret[i].course_id);
                            $("#con_mid_bottom").before($cloneNode);
                        }
                        //全选
                        $("input[name='allCheck']").click(function () {
                            var $ret = $(this).prop("checked");
                            $("input[name='checkOne']").each(function () {
                                $(this).prop('checked', $ret);
                            });
                            var total = 0;
                            var $checkBox = $("input[name='checkOne']");
                            var $price = $(".price");
                            $checkBox.each(function () {
                                if ($(this).prop("checked")) {
                                    var i = $checkBox.index($(this));
                                    total += parseFloat($price.eq(i).text());
                                }
                            });
                            $("#total").text(total);
                        });

                        $("#coursecount").text(ret.length);
                    }
                    else {
                        $("#con_mid").hide();
                        var $node = '<div><img src="images/cartzero.png"></div>'
                        $("#con_head").after($node);
                        $("#coursecount").text(ret.length);
                    }
                }
            })

            $(".class_delete").click(function () {
                $(this).parent().parent().remove();
                $.ajax({
                    url: "/DeleteCourseFromCart",
                    type: "post",
                    data: {
                        "course_id": $(this).attr("id"),
                        "user_id":user_id,
                    },
                    dataType: "text",
                })
            })

            $("#orderbutton").click(function () {
                if ($("#total").text() == 0) {
                    //alert("选择课程")
                    layer.msg("请选择课程",{time:1000});
                }else {
                    var arrCourse_id = new Array();
                    var i = 0;
                    $("input[name='checkOne']").each(function () {
                        if ($(this).prop("checked")) {
                            arrCourse_id[i] = $(this).attr("id");
                            i++;
                        }
                    });
                    var ordercourse_id = arrCourse_id.join(",");
                    //alert(ordercourse_id);
                    document.cookie="ordercourse_id="+ordercourse_id;
                    window.location.href="orderCheck.html";
                }
            })

        })
    </script>
</head>
<body>
<div id="header">
    <div>
        <div id="logo"><a href="index.html" target="_self"><img src="images/logo.png"></a></div>
        <div id="header-guide">
            <a href="" target="_blank"><div class="header-guide">精选好课</div></a>
            <a href="" target="_blank"><div class="header-guide">免费好课</div></a>
            <a href="" target="_blank"><div class="header-guide">分享网站</div></a>
        </div>
        <input type="text" id="header-search" value="搜索课程...">
        <a href="" target="_blank" id="searchbutton"><img src="images/header-search.png" id="header-icon"></a>
        <div id="header-options">
            <a href="" target="_blank">我的学习</a>
            <i id="news-count">0</i>
            <a href="news.html" target="_blank">消息</a>
            <i id="cart-count">0</i>
            <a href="" target="_blank">购物车</a>
            <span>|</span>
            <a href="" id="weidenglu" title="登录/注册">登录/注册</a>
            <div id="touxiang"><img src="images/small.jpg"></div>
        </div>
        <div id="touxiang-details">
            <div id="xiaojiantou"></div>
            <div id="details">
                <table class="layui-table" lay-skin="line" >
                    <colgroup>
                        <col width="150">
                        <col width="150">
                        <col width="200">
                    </colgroup>
                    <tr>
                        <td style="display: block;width: 145px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;" title="个性签名">个性签名。。ffffffffffffffffffffff</td>
                    </tr>
                    </tbody>
                </table>
                <button class="layui-btn layui-btn-primary">我的订单</button>
                <br><br>
                <button class="layui-btn layui-btn-danger" id="calcel">注销</button>
            </div>
        </div>
        <div id="header-fenxiang">
            <a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=www.baidu.com" target="_blank"><div class="header-fx" id="header-fx1"></div></a>
            <a href="http://service.weibo.com/share/share.php?url=www.baidu.com" target="_blank"><div class="header-fx" id="header-fx2"></div></a>
            <a href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=www.baidu.com" target="_blank"><div class="header-fx" id="header-fx3"></div></a>
        </div>
        <div id="search-tishi">
        </div>
    </div>
</div>
<div class="b-30"></div>
<div class="b-30"></div>
<div id="right-float">
    <div class="right-float-div" id="right-float-jqr"></div>
    <a href="" onclick="return false"><div id="right-jqr"></div></a>
    <div class="rf-line"></div>
    <div class="right-float-div"><img src="images/gongzhonghao.png" class="right-icon"></div>
    <a href="" onclick="return false"><div id="right-gzh"><p>关&nbsp;注<br>我&nbsp;们</p></div></a>
    <div class="rf-line"></div>
    <div class="right-float-div"><img src="images/huidaodingbu.png" class="right-icon "></div>
    <a href="#" id="back_to_top"><div id="right-hddb"><p>回&nbsp;到<br>顶&nbsp;部</p></div></a>
    <div id="erweima">
        <img src="images/gongzhonghao.jpg" id="weixin">
        <span>关注微信</span>
    </div>
</div>
<div id="regedit-body">
    <div id="regedit-title">
        <div id="regedit-title1"></div>
    </div>
    <div id="regedit_middle">
        <ul>
            <li><img src="images/lqlogo.png"style="width: 50px" height="50"></li>
            <li><span>手机号登录</span></li>
        </ul>
    </div>
    <div id="regedit-title-right"></div>
    <div id="regedit-title-right1">
        <span name="ideas">使用短信验证登录</span>
    </div>
    <div id="regedit-form">
        <form action="" method="post" id="regedited">
            <div class="regedit-user">
                <div class="regedit-user-left">
                </div>
                <div class="regedit_input">
                    <input type="text" placeholder="请输入手机号" style="border: none" name="phone">
                </div>
            </div>
            <div class="regedit-user1">
                <div class="regedit-user-left1">
                </div>
                <div class="regedit_input">
                    <input type="password" placeholder="请输入密码" style="border: none" name="pwd">
                </div>
            </div>
            <div id="regedit_btn"><input type="button" value="登录"></div>
            <div id="regedit-last">
                <ul>
                    <li><input type="checkbox" checked></li>
                    <li><p>十天免登录</p></li>
                    <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>|</span></li>
                    <li><a href="https://mob.163.com/web/passwdfind">忘记密码？</a></li>
                </ul>
            </div>
            <div id="regedit-last-right">
                <span style="color: #49AF4F" name="login">去注册 ></span>
            </div>
        </form>
    </div>
</div>
<div id="container">
    <!--我的购物车-->
    <div id="con_head">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="b-30"></div>
                    <div class="col-md-12" id="carthead">
                        <h6>我的购物车</h6>&nbsp;
                        <span>共<span id="coursecount">4</span>门课程</span>
                    </div>
                    <div class="b-20"></div>
                </div>
            </div>
        </div>
    </div>
    <!--购物车内容-->
    <div id="con_mid">
        <!--全选-->
        <div id="con_mid_top">
            <div class="cb">
                <input type="checkbox" name="allCheck">
            </div>
            <div id="con_mid_top_1">全选</div>
            <div id="con_mid_top_2">课程名称</div>
            <div id="con_mid_top_3">学期或课程有效期</div>
            <div id="con_mid_top_4">单价（元）</div>
        </div>
        <!--详细信息 模板-->
        <div class="info_tmpl">
            <div class="b-30"></div>
            <!--机构名-->
            <div class="school_tmpl">
                <div class="school_name">机构&nbsp;<a href=""><span class="company">Java架构漫谈</span></a></div>
            </div>
            <div class="b-10" style="margin-top: 17px;"></div>
            <!--课程信息-->
            <div class="class_tmpl">
                <div class="cb">
                    <input type="checkbox" name="checkOne" class="checkone">
                </div>
                <div class="class_img">
                    <img src="images/classimg1.png" alt="" class="cover" style="width: 120px;height: 69px">
                </div>
                <div class="class_name">
                    <a href=""><span class="course_name">深度解剖dubbo源码</span></a>
                </div>
                <div class="class_term">
                    <span>永久有效</span>
                </div>
                <div class="class_price">
                    <span class="price">1799</span>.00
                </div>
                <div class="class_delete">
                    <span class="deletecourse"><a href="" onclick="return false"><i class="fa fa-trash-o fa-lg"></i></a></span>
                </div>
            </div>
            <!--单价-->
            <div class="price_tmpl">
                <div class="totalPrice">
                    该机构小计：￥<span class="price1">1799</span>.00
                </div>
            </div>
            <div class="b-30"></div>
        </div>
        <div id="con_mid_bottom">
            <!--结算-->
            <div id="con_mid_bottom_2">合计：<span>￥<span id="total">0</span>.00</span></div>
            <div id="con_mid_bottom_3">(若购买享有优惠，相应金额将在订单结算页面减扣)</div>
            <div id="order">
                <button type="button" class="btn btn-danger btn-lg" id="orderbutton"
                        style="position:relative;top: 4px;">去结算
                </button>
            </div>
        </div>
    </div>
</div>
<div id="footer" style="margin-top: 200px">
    <div id="footer-top">
        <div class="footer-center">
            <ul id="hzjg">
                <li>合作机构</li>
                <li>蓝桥软件学院</li>
            </ul>
        </div>
    </div>
    <div id="footer-bottom">
        <div class="footer-center">
            <ul>
                <li>蓝桥云课堂 专注于职场与生活领域的技能提升。</li>
            </ul>
            <ul>
                <li><a href="">关于我们</a></li>
                <li><a href="">联系我们</a></li>
                <li><a href="">帮助中心</a></li>
                <li><a href="">企业培训</a></li>
                <li><a href="">中国大学MOOC</a></li>
                <li><a href="">蓝桥卡搭编程</a></li>
                <li><a href="">蓝桥100分</a></li>
            </ul>
            <ul>
                <li id="copyright">©1997-2018 网易公司 版权所有</li>
            </ul>
        </div>
    </div>
</div>

</body>
</html>