<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的订单 - 蓝桥云课堂</title>
    <link rel="stylesheet" href="css/myorder.css">
    <link rel="stylesheet" href="bootstrap-3.3.7/css/bootstrap.css">
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/regedit.css" type="text/css">

    <script src="js/jquery-3.3.1.js"></script>
    <script src="bootstrap-3.3.7/js/bootstrap.js"></script>
    <script src="layui/layui.js" type="application/javascript"></script>
    <script src="js/general.js" type="application/javascript"></script>
    <script src="js/jquery.validate.js" type="application/javascript"></script>
    <script src="js/index1.js"></script>
    <script>
        $(function () {
            //获取cookie字符串
            var strCookie = document.cookie;
            //将多cookie切割为多个名/值对
            var arrCookie = strCookie.split("; ");
            var user_id;
            //遍历cookie数组，处理每个cookie对
            for (var i = 0; i < arrCookie.length; i++) {
                var arr = arrCookie[i].split("=");
                //找到名称为userId的cookie，并返回它的值
                if ("user_id" == arr[0]) {
                    user_id = arr[1];
                    break;
                }
            }

            $.ajax({
                url: "/ShowMyOrder",
                type: "post",
                dataType: "json",
                data: {
                    "user_id": user_id,
                },
                success: function (ret) {
                    if (ret.length > 0) {
                        var $modelNode = $(".order_info").detach();
                        var $modelNode1 = $(".order_info1").detach();
                        for (var i = 0; i < ret.length; i++) {
                            switch (ret[i].order_status) {
                                case 1:
                                    var $cloneNode1 = $modelNode1.clone(true);
                                    $cloneNode1.find("span.order_time").text(ret[i].order_time);
                                    $cloneNode1.find("span.order_id").text(ret[i].order_id);
                                    $cloneNode1.find("span.course_name").text(ret[i].course_name);
                                    $cloneNode1.find("span.price").text(ret[i].price);
                                    $cloneNode1.find("div.orderCancel").attr("id", ret[i].order_id);

                                    var $cloneNode2 = $modelNode1.clone(true);
                                    $cloneNode2.find("span.order_time").text(ret[i].order_time);
                                    $cloneNode2.find("span.order_id").text(ret[i].order_id);
                                    $cloneNode2.find("span.course_name").text(ret[i].course_name);
                                    $cloneNode2.find("span.price").text(ret[i].price);
                                    $cloneNode2.find("div.orderCancel").attr("id", ret[i].order_id);
                                    $("#paid").append($cloneNode1);
                                    $("#allOrder").append($cloneNode2);
                                    break;
                                case 0:
                                    var $cloneNode = $modelNode.clone(true);
                                    $cloneNode.find("span.order_time").text(ret[i].order_time);
                                    $cloneNode.find("span.order_id").text(ret[i].order_id);
                                    $cloneNode.find("span.course_name").text(ret[i].course_name);
                                    $cloneNode.find("span.price").text(ret[i].price);
                                    $cloneNode.find("div.orderCancel").attr("id", ret[i].order_id);
                                    $cloneNode.find("div.orderPayButton").attr("id", ret[i].course_id);

                                    var $cloneNode3 = $modelNode.clone(true);
                                    $cloneNode3.find("span.order_time").text(ret[i].order_time);
                                    $cloneNode3.find("span.order_id").text(ret[i].order_id);
                                    $cloneNode3.find("span.course_name").text(ret[i].course_name);
                                    $cloneNode3.find("span.price").text(ret[i].price);
                                    $cloneNode3.find("div.orderCancel").attr("id", ret[i].order_id);
                                    $cloneNode3.find("div.orderPayButton").attr("id", ret[i].course_id);
                                    $("#toBePaid").append($cloneNode);
                                    $("#allOrder").append($cloneNode3);
                                    break;
                            }
                        }
                    }else {
                        $("#allOrder").hide();
                        $("#toBePaid").hide();
                         $("#paid").hide();
                        var $node = '<div style="position:relative;left: 330px"><img src="images/orderzero.png"></div>' +
                            '<h4 style="text-align: center">还没有课程，去 <a href="">【 精选好课 】</a> 选自己喜欢的课程吧</h4>'
                        $("#con_top_1").after($node);
                    }
                }
            })
            //重新去支付
            $(".orderPayButton").click(function () {
                var repayid = $(this).attr("id");
                document.cookie = "repayid=" + repayid;
                window.location.href = "pay.html";
            })


            //删除订单
            $(".orderCancel").click(function () {
                var id = $(this).attr("id");
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.open({
                        type: 1,
                        title:"删除订单",
                        content: '<div style="padding: 20px 100px;">确定要删除此订单信息吗？</div>',
                        btn: ['确定', '取消'],
                        btnAlign: 'r',
                        yes: function () {
                            for (var i = 0; i < 2; i++) {
                                $("#" + id).parent().parent().parent().remove();
                            }
                            $.ajax({
                                url: "/DeleteOrder",
                                type: "post",
                                data: {
                                    "order_id": id,
                                },
                                dataType: "text",
                            })

                            layer.closeAll()
                        }
                    });
                });
            })

        })
    </script>
</head>
<body>
<div id="header">
    <div>
        <div id="logo"><a href="index.html" target="_self"><img src="images/logo.png"></a></div>
        <div id="header-guide">
            <a href="allClass.html?name=全部课程&type=0" target="_blank"><div class="header-guide">精选好课</div></a>
            <a href="allClass.html?name=全部课程&type=0" target="_blank"><div class="header-guide">免费好课</div></a>
            <a href="" target="_blank"><div class="header-guide">分享网站</div></a>
        </div>
        <input type="text" id="header-search" value="搜索课程...">
        <a href="" target="_blank" id="searchbutton"><img src="images/header-search.png" id="header-icon"></a>
        <div id="header-options">
            <a href="myStudy.html" target="_self" id="wdxx">我的学习</a>
            <i id="news-count">0</i>
            <a href="news.html" target="_self" id="news">消息</a>
            <i id="cart-count">0</i>
            <a href="cart.html" target="_self" id="gwc">购物车</a>
            <span>|</span>
            <a href="" id="weidenglu" title="登录/注册">登录/注册</a>
            <a href="userMain.html" id="yidenglu">..</a>
            <div id="touxiang"><img src="images/small.jpg"></div>
        </div>
        <div id="touxiang-details">
            <div id="xiaojiantou"></div>
            <div id="details">
                <table class="layui-table" lay-skin="line" >
                    <colgroup>
                        <col width="150">
                        <col width="150">
                        <col width="200">
                    </colgroup>
                    <tr>
                        <td style="display: block;width: 145px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;" title="个性签名">个性签名。。ffffffffffffffffffffff</td>
                    </tr>
                    </tbody>
                </table>
                <button class="layui-btn layui-btn-primary" onclick="window.location.href='myorder.html'">我的订单</button>
                <br><br>
                <button class="layui-btn layui-btn-danger" id="calcel">注销</button>
            </div>
        </div>
        <div id="header-fenxiang">
            <a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=www.baidu.com" target="_blank"><div class="header-fx" id="header-fx1"></div></a>
            <a href="http://service.weibo.com/share/share.php?url=www.baidu.com" target="_blank"><div class="header-fx" id="header-fx2"></div></a>
            <a href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=www.baidu.com" target="_blank"><div class="header-fx" id="header-fx3"></div></a>
        </div>
        <div id="search-tishi">
        </div>
    </div>
</div>
<div class="b-30"></div>
<div class="b-30"></div>
<div id="right-float">
    <div class="right-float-div" id="right-float-jqr"></div>
    <a href="" onclick="return false"><div id="right-jqr"></div></a>
    <div class="rf-line"></div>
    <div class="right-float-div"><img src="images/gongzhonghao.png" class="right-icon"></div>
    <a href="" onclick="return false"><div id="right-gzh"><p>关&nbsp;注<br>我&nbsp;们</p></div></a>
    <div class="rf-line"></div>
    <div class="right-float-div"><img src="images/huidaodingbu.png" class="right-icon "></div>
    <a href="#" id="back_to_top"><div id="right-hddb"><p>回&nbsp;到<br>顶&nbsp;部</p></div></a>
    <div id="erweima">
        <img src="images/gongzhonghao.jpg" id="weixin">
        <span>关注微信</span>
    </div>
</div>
<div id="regedit-body">
    <div id="regedit-title">
        <div id="regedit-title1"></div>
    </div>
    <div id="regedit_middle">
        <ul>
            <li><img src="images/lqlogo.png"style="width: 50px" height="50"></li>
            <li><span>手机号登录</span></li>
        </ul>
    </div>
    <div id="regedit-title-right"></div>
    <div id="regedit-title-right1">
        <span name="ideas">使用短信验证登录</span>
    </div>
    <div id="regedit-form">
        <form action="" method="post" id="regedited">
            <div class="regedit-user">
                <div class="regedit-user-left">
                </div>
                <div class="regedit_input">
                    <input type="text" placeholder="请输入手机号" style="border: none" name="phone">
                </div>
            </div>
            <div class="regedit-user1">
                <div class="regedit-user-left1">
                </div>
                <div class="regedit_input">
                    <input type="password" placeholder="请输入密码" style="border: none" name="pwd">
                </div>
            </div>
            <div id="regedit_btn"><input type="button" value="登录"></div>
            <div id="regedit-last">
                <ul>
                    <li><input type="checkbox" checked></li>
                    <li><p>十天免登录</p></li>
                    <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>|</span></li>
                    <li><a href="https://mob.163.com/web/passwdfind">忘记密码？</a></li>
                </ul>
            </div>
            <div id="regedit-last-right">
                <span style="color: #49AF4F" name="login">去注册 ></span>
            </div>
        </form>
    </div>
</div>
<div class="b-30"></div>
<div id="con_top">
    <div id="con_top_1">
        <span style="font-size: 16px">我的订单</span>
        <div class="b-20"></div>
        <ul id="myTab" class="nav nav-tabs">
            <li class="active">
                <a href="#allOrder" data-toggle="tab">全部订单</a>
            </li>
            <li>
                <a href="#toBePaid" data-toggle="tab">待支付</a>
            </li>
            <li>
                <a href="#paid" data-toggle="tab">交易完成</a>
            </li>
        </ul>
    </div>
    <div id="myTabContent" class="tab-content">
        <div class="b-30"></div>
        <!--全部订单-->
        <div class="tab-pane fade in active" id="allOrder">
            <div class="orderHead">
                <div class="head1">订单信息</div>
                <div class="head2">单价（元）</div>
                <div class="head3">交易状态</div>
                <div class="head4">交易操作</div>
            </div>

        </div>
        <!--待支付-->
        <div class="tab-pane fade" id="toBePaid">
            <div class="orderHead">
                <div class="head1">订单信息</div>
                <div class="head2">单价（元）</div>
                <div class="head3">交易状态</div>
                <div class="head4">交易操作</div>
            </div>
            <!--未支付订单信息 模板-->
            <div class="order_info">
                <div class="order_info_1">
                    <div class="orderTime"><span class="order_time">2018-08-28 14:57</span></div>
                    <div class="orderID">订单号：<span class="order_id">1</span></div>
                </div>
                <div class="order_info_2">
                    <div class="className"><a href=""><span class="course_name">Netty线上服务器q部署</span></a></div>
                    <div class="classTerm"><span style="color: #f10215">永久有效</span></div>
                    <div class="classPrice"><span class="price">199</span></div>
                    <div class="order_id"></div>
                    <div class="orderStatus">待支付</div>
                    <div class="orderOperate">
                        <div class="orderPayButton">
                            <button type="button" class="btn btn-warning" class="orderbutton">去支付</button>
                        </div>
                        <div class="orderCancel"><a href="" onclick="return false">取消订单</a></div>
                    </div>
                </div>
            </div>
        </div>
        <!--交易完成-->
        <div class="tab-pane fade" id="paid">
            <div class="orderHead">
                <div class="head1">订单信息</div>
                <div class="head2">单价（元）</div>
                <div class="head3">交易状态</div>
                <div class="head4">交易操作</div>
            </div>
            <!--交易完成订单信息 模板-->
            <div class="order_info1">
                <div class="order_info_1">
                    <div class="orderTime"><span class="order_time">2018-08-28 14:57</span></div>
                    <div class="orderID">订单号：<span class="order_id">1</span></div>
                </div>
                <div class="order_info_2">
                    <div class="className"><a href=""><span class="course_name">Netty线上服务器q部署</span></a></div>
                    <div class="classTerm"><span style="color: #f10215">永久有效</span></div>
                    <div class="classPrice"><span class="price">199</span></div>
                    <div class="order_id"></div>
                    <div class="orderStatus">交易完成</div>
                    <div class="orderOperate">
                        <div class="orderCancel" style="margin-top: 10px"><a href="" onclick="return false">删除订单</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<div id="footer" style="margin-top: 200px">
    <div id="footer-top">
        <div class="footer-center">
            <ul id="hzjg">
                <li>合作机构</li>
                <li>蓝桥软件学院</li>
            </ul>
        </div>
    </div>
    <div id="footer-bottom">
        <div class="footer-center">
            <ul>
                <li>蓝桥云课堂 专注于职场与生活领域的技能提升。</li>
            </ul>
            <ul>
                <li><a href="">关于我们</a></li>
                <li><a href="">联系我们</a></li>
                <li><a href="">帮助中心</a></li>
                <li><a href="">企业培训</a></li>
                <li><a href="">中国大学MOOC</a></li>
                <li><a href="">蓝桥卡搭编程</a></li>
                <li><a href="">蓝桥100分</a></li>
            </ul>
            <ul>
                <li id="copyright">©1997-2018 网易公司 版权所有</li>
            </ul>
        </div>
    </div>
</div>
</body>
</html>